{"version":3,"sources":["ng://@ngx-gallery/gallerize/lib/gallerize.directive.ts","ng://@ngx-gallery/gallerize/lib/gallerize.module.ts"],"names":["GallerizeDirective","_zone","_el","_gallery","_lightbox","_renderer","platform","_document","_galleryCmp","this","_galleryId","selector","isPlatformBrowser","_mode","prototype","ngOnInit","_this","runOutsideAngular","gallerize","ref","detectorMode","galleryMode","ngOnDestroy","_detector$","complete","_observer$","disconnect","_itemClick$","unsubscribe","_itemChange$","galleryRef","itemClick","subscribe","i","open","itemsChanged","state","load","items","Subject","pipe","debounceTime","switchMap","imageElements","nativeElement","querySelectorAll","length","images_1","from","map","el","setStyle","setProperty","run","HTMLImageElement","src","getAttribute","thumb","background","currentStyle","defaultView","getComputedStyle","backgroundImage","slice","replace","tap","data","push","ImageItem","finalize","EMPTY","MutationObserver","next","observe","childList","subtree","Directive","args","NgZone","ElementRef","Gallery","Lightbox","Renderer2","Object","decorators","type","Inject","PLATFORM_ID","DOCUMENT","GalleryComponent","Host","Self","Optional","Input","GallerizeModule","NgModule","imports","GalleryModule","LightboxModule","declarations","exports"],"mappings":"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","sourcesContent":["import {\n  Directive,\n  Input,\n  OnInit,\n  OnDestroy,\n  Inject,\n  Optional,\n  Self,\n  Host,\n  NgZone,\n  ElementRef,\n  Renderer2,\n  PLATFORM_ID\n} from '@angular/core';\nimport { DOCUMENT, isPlatformBrowser } from '@angular/common';\n\nimport { Gallery, GalleryRef, ImageItem, GalleryComponent, GalleryState, GalleryItem } from '@ngx-gallery/core';\nimport { Lightbox } from '@ngx-gallery/lightbox';\n\nimport { Subject, Subscription, from, EMPTY } from 'rxjs';\nimport { tap, map, switchMap, finalize, debounceTime } from 'rxjs/operators';\n\n/**\n * This directive has 2 modes:\n * 1 - If host element is a HTMLElement, it detects the images and hooks their clicks to lightbox\n * 2 - If host element is a GalleryComponent, it hooks the images click to the lightbox\n */\n\nconst enum GallerizeMode {\n  Detector = 'detector',\n  Gallery = 'gallery'\n}\n\n@Directive({\n  selector: '[gallerize]'\n})\nexport class GallerizeDirective implements OnInit, OnDestroy {\n\n  /** Default gallery id */\n  private _galleryId = 'lightbox';\n\n  /** Gallerize mode */\n  private readonly _mode: GallerizeMode;\n\n  /** If host element is a HTMLElement, will use the following variables: */\n\n  /** Stream that emits to fire the detection stream the image elements has changed */\n  private _observer$: any;\n\n  /** Stream that emits when image is discover */\n  private _detector$: Subject<any>;\n\n  /** If host element is a GalleryComponent, will use the following variables: */\n\n  /** Gallery events (if used on a gallery component) */\n  private _itemClick$: Subscription;\n  private _itemChange$: Subscription;\n\n  // ======================================================\n\n  /** If set, it will become the gallery id */\n  @Input() gallerize: string;\n\n  /** The selector used to query images elements */\n  @Input() selector = 'img';\n\n  constructor(private _zone: NgZone,\n              private _el: ElementRef,\n              private _gallery: Gallery,\n              private _lightbox: Lightbox,\n              private _renderer: Renderer2,\n              @Inject(PLATFORM_ID) platform: Object,\n              @Inject(DOCUMENT) private _document: any,\n              @Host() @Self() @Optional() private _galleryCmp: GalleryComponent) {\n\n    // Set gallerize mode\n    if (isPlatformBrowser(platform)) {\n      this._mode = _galleryCmp ? GallerizeMode.Gallery : GallerizeMode.Detector;\n    }\n  }\n\n  ngOnInit() {\n    this._zone.runOutsideAngular(() => {\n      this._galleryId = this.gallerize || this._galleryId;\n      const ref = this._gallery.ref(this._galleryId);\n\n      switch (this._mode) {\n        case GallerizeMode.Detector:\n          this.detectorMode(ref);\n          break;\n        case GallerizeMode.Gallery:\n          this.galleryMode(ref);\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    switch (this._mode) {\n      case GallerizeMode.Detector:\n        this._detector$.complete();\n        this._observer$.disconnect();\n        break;\n      case GallerizeMode.Gallery:\n        this._itemClick$.unsubscribe();\n        this._itemChange$.unsubscribe();\n    }\n  }\n\n  /** Gallery mode: means `gallerize` directive is used on `<gallery>` component\n   * Adds a click event to each gallery item so it opens in lightbox */\n  private galleryMode(galleryRef: GalleryRef) {\n    // Clone its items to the new gallery instance\n    this._itemClick$ = this._galleryCmp.galleryRef.itemClick.subscribe((i: number) => this._lightbox.open(i, this._galleryId));\n    this._itemChange$ = this._galleryCmp.galleryRef.itemsChanged.subscribe((state: GalleryState) => galleryRef.load(state.items));\n  }\n\n  /** Detector mode: means `gallerize` directive is used on a normal HTMLElement\n   *  Detects images and adds a click event to each image so it opens in the lightbox */\n  private detectorMode(galleryRef: GalleryRef) {\n    this._detector$ = new Subject();\n    // Query image elements\n    this._detector$.pipe(\n      debounceTime(300),\n      switchMap(() => {\n\n        /** get all img elements from content */\n        const imageElements = this._el.nativeElement.querySelectorAll(this.selector);\n\n        if (imageElements && imageElements.length) {\n\n          const images: GalleryItem[] = [];\n\n          return from(imageElements).pipe(\n            map((el: any, i) => {\n              // Add click event to the image\n              this._renderer.setStyle(el, 'cursor', 'pointer');\n              this._renderer.setProperty(el, 'onclick', () =>\n                this._zone.run(() => this._lightbox.open(i, this._galleryId))\n              );\n\n              if (el instanceof HTMLImageElement) {\n                // If element is type of img use the src property\n                return {\n                  src: el.getAttribute('imageSrc') || el.src,\n                  thumb: el.getAttribute('thumbSrc') || el.src\n                };\n              } else {\n                // Otherwise, use element background-image url\n                const elStyle = el.currentStyle || this._document.defaultView.getComputedStyle(el, null);\n                const background = elStyle.backgroundImage.slice(4, -1).replace(/\"/g, '');\n                return {\n                  src: el.getAttribute('imageSrc') || background,\n                  thumb: el.getAttribute('thumbSrc') || background\n                };\n              }\n            }),\n            tap((data: any) => images.push(new ImageItem(data))),\n            finalize(() => galleryRef.load(images))\n          );\n        } else {\n          return EMPTY;\n        }\n      })\n    ).subscribe();\n\n    // Observe content changes\n    this._observer$ = new MutationObserver(() => this._detector$.next());\n    this._observer$.observe(this._el.nativeElement, {childList: true, subtree: true});\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { GalleryModule } from '@ngx-gallery/core';\nimport { LightboxModule } from '@ngx-gallery/lightbox';\nimport { GallerizeDirective } from './gallerize.directive';\n\n@NgModule({\n  imports: [\n    GalleryModule,\n    LightboxModule\n  ],\n  declarations: [GallerizeDirective],\n  exports: [GallerizeDirective]\n})\nexport class GallerizeModule {\n\n}\n"]}